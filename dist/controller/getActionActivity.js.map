{"version":3,"sources":["../../src/controller/getActionActivity.js"],"names":["getActionActivity","req","res","console","log","params","idBoard","start","end","Date","activity","d","cond2Date","cond3Date","cond3_1Date","cond3_2Date","cond4Date","hour","getHours","minute","getMinutes","now","setDate","getDate","iDate","ymdd","find","dateString","sort","date","findActions","len","length","timeago","i","dayAction","getDay","hourAction","minuteAction","dayCond","calTime","Math","floor","act","id","idMemberCreator","memberCreator","data","type","push","json"],"mappings":"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","file":"getActionActivity.js","sourcesContent":["import {Actions} from '../models/actions'\nimport {convertDates} from './convertDates'\n\nexport const getActionActivity = async(req, res) => {\n    console.log(`GET '/getactionactivity/${req.params.idBoard}/${req.params.start}/${req.params.end}' ðŸ¤  ${Date()}`)\n\n    const idBoard = req.params.idBoard\n    const start = req.params.start\n    const end = req.params.end\n    \n    let activity = []\n    let d = new Date() \n    let cond2Date = new Date() \n    let cond3Date = new Date() \n    let cond3_1Date = new Date()\n    let cond3_2Date = new Date()\n    let cond4Date = new Date()\n\n    let hour = (d.getHours())\n    let minute = (d.getMinutes())\n    const now = convertDates(d)\n    cond2Date.setDate(cond2Date.getDate()-7)\n    cond3Date.setDate(cond3Date.getDate()-30)\n    cond3_1Date.setDate(cond3_1Date.getDate()-14)\n    cond3_2Date.setDate(cond3_2Date.getDate()-21)\n    cond4Date.setDate(cond4Date.getDate()-60)\n    for (let iDate = new Date(end); iDate >= new Date(start); iDate.setDate(iDate.getDate() - 1)) {\n        let ymdd = await convertDates(iDate)\n        let findActions = await Actions.find({ \"data.board.id\": idBoard ,dateString:ymdd}).sort({date: -1})  //now to ago\n        const len = findActions.length\n        let timeago\n        for(let i=0;i<len;i++){\n            let dayAction = (findActions[i].date.getDay())\n            let hourAction = (findActions[i].date.getHours())\n            let minuteAction = (findActions[i].date.getMinutes())\n            let dayCond = (cond2Date.getDay())\n\n            if (findActions[i].dateString == now) {\n                let calTime = (hour * 60 + minute) - (hourAction * 60 + minuteAction)\n                if (calTime >= 60)\n                    timeago = Math.floor(calTime / 60) + \" hour ago\"\n                else\n                    timeago = calTime + \" minute ago\"\n            }\n            else if (cond2Date < findActions[i].date) {\n                if (cond2Date.getDate() == findActions[i].date.getDate())\n                    timeago = \"6 day ago\"\n                else if (dayAction < dayCond)\n                    timeago = dayCond - dayAction + \" day ago\"\n                else\n                    timeago = (7 - dayAction + dayCond) + \" day ago\"\n            }\n            else if (cond3Date < findActions[i].date) {\n                if (cond3_1Date < findActions[i].date)\n                    timeago = \"1 week ago\"\n                else if (cond3_2Date < findActions[i].date)\n                    timeago = \"2 week ago\"\n                else\n                    timeago = \"3 week ago\"\n            }\n            else {\n                if (cond4Date < findActions[i].date)\n                    timeago = \"1 month ago\"\n                else\n                    timeago = \"2 month ago\"\n            }\n            const act = {\n                id: findActions[i].id,\n                idMemberCreator: findActions[i].idMemberCreator,\n                memberCreator: findActions[i].memberCreator,\n                data: findActions[i].data,\n                type: findActions[i].type,\n                date: findActions[i].date,\n                dateString: findActions[i].dateString,\n                timeago: timeago\n            }\n            activity.push(act)\n        }\n    }\n    res.json(activity)\n}\n\n"]}