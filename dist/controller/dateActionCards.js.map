{"version":3,"sources":["../../src/controller/dateActionCards.js"],"names":["createDateActionCards","dateStart","dashboard","now","Date","countBack","countInpr","countComp","d","ymd","find","dateString","dataThisDay","len","length","listBack","listInpr","listComp","i","data","type","indexOf","list","id","listAfter","listBefore","allData","date","idDashboard","_id","findOne","dateActionCards","createnewDateActionCards","callDateActionCards","setDate","getDate","DateActionCards","create","newDateActionCards","update","$set"],"mappings":"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","file":"dateActionCards.js","sourcesContent":["import Trello from 'node-trello'\r\nimport {DateActionCards} from '../models/dateActionCards'\r\nimport {Actions} from '../models/actions'\r\nimport {convertDates} from './convertDates'\r\n\r\nexport const createDateActionCards = async(dateStart,dashboard) => {\r\n    const now = new Date()\r\n    let countBack = 0 \r\n    let countInpr = 0\r\n    let countComp = 0\r\n    for (let d = new Date(dateStart); d <= now; d.setDate(d.getDate() + 1)) {\r\n        const ymd = await convertDates(d)\r\n        const dataThisDay =  await Actions.find({dateString: ymd})\r\n        const len = dataThisDay.length\r\n        const listBack = dashboard.listBack\r\n        const listInpr = dashboard.listInpr\r\n        const listComp = dashboard.listComp\r\n        for(let i=0;i<len;i++){\r\n            const data = dataThisDay[i].data\r\n            if(dataThisDay[i].type==\"createCard\"){\r\n                if (listBack.indexOf(data.list.id) != -1) countBack++\r\n                else if (listInpr.indexOf(data.list.id) != -1) countInpr++\r\n                else if (listComp.indexOf(data.list.id) != -1) countComp++\r\n            }\r\n            else if(dataThisDay[i].type==\"updateCard\" && data.listAfter && data.listBefore){\r\n                if (listBack.indexOf(data.listAfter.id) != -1) countBack++\r\n                else if (listInpr.indexOf(data.listAfter.id) != -1) countInpr++\r\n                else if (listComp.indexOf(data.listAfter.id) != -1) countComp++\r\n\r\n                if (listBack.indexOf(data.listBefore.id) != -1) countBack--\r\n                else if (listInpr.indexOf(data.listBefore.id) != -1) countInpr--\r\n                else if (listComp.indexOf(data.listBefore.id) != -1) countComp--\r\n            }\r\n        }\r\n        const allData = {\r\n            date: d,\r\n            dateString: ymd,\r\n            countBack: countBack,\r\n            countInpr: countInpr,\r\n            countComp: countComp,\r\n            idDashboard: dashboard._id\r\n        }\r\n        const dateActionCards = await DateActionCards.findOne({ dateString: allData.dateString, idDashboard: allData.idDashboard})\r\n        const callDateActionCards = await createnewDateActionCards(DateActionCards,allData,dateActionCards)\r\n        // if (callDateActionCards)\r\n        //     console.log(\"create or update new DateActionCards complete\")\r\n        // else\r\n        //     console.log(\"have a DateActionCards already!!\")\r\n    }\r\n}\r\n\r\nexport const createnewDateActionCards = async (DateActionCards,allData,dateActionCards) => {\r\n    if (!dateActionCards) {\r\n        const newDateActionCards = await DateActionCards.create(allData)\r\n        return newDateActionCards\r\n    }\r\n    else if (allData.countBack != dateActionCards.countBack || allData.countInpr != dateActionCards.countInpr || allData.countComp != dateActionCards.countComp ) {\r\n        const newDateActionCards = await DateActionCards.update({id: dateActionCards._id},{$set:{\r\n            countBack: allData.countBack,\r\n            countInpr: allData.countInpr,\r\n            countComp: allData.countComp\r\n        }})\r\n        return newDateActionCards\r\n    } \r\n    else\r\n        return false\r\n}\r\n\r\n"]}